<!DOCTYPE html>
<html>
	<head>
		<title>Importance Configuration</title>
		<link rel='stylesheet' type='text/css' href='css/slate.min.css'>		
	</head>
	<body>
		<div class="item-container">
			<div class="item-container-header">Time</div>
			<div class="item-container-content">
				<label class="item">
					Display Seconds
					<input type="checkbox" class="item-toggle" id="seconds_toggle">
				</label>
			</div>
			<div class="item-container-footer">
				Please note that changing some of these settings could drastically impact battery life.
			</div>
		</div>
		<div class="item-container">
			<div class="item-container-header">Battery Bar</div>
			<div class="item-container-content">
				<label class="item">
					Foreground Color
					<input type="text" class="item-color item-color-normal" id="battery_fg_color" value="#00AAFF">
				</label>
				<label class="item">
					Background Color
					<input type="text" class="item-color item-color-normal" id="battery_bg_color" value="#0000AA">
				</label>
			</div>
		</div>
		<div class="item-container">
			<div class="button-container">
				<input type="button" class="item-button" value="SUBMIT" id="submit-button">
			</div>
		</div>
		
		<script src='js/slate.min.js'></script>
		<script>
		(function() {
			loadOptions();
			submitHandler();
		})();
		
		function submitHandler() {
			var $submitButton = $('#submit-button');
			
			$submitButton.on('click', function() {
				console.log('Submit clicked');
				
				var return_to = getQueryParam('return_to', 'pebblejs://close#');
				document.location = return_to + encodeURIComponent(JSON.stringify(getAndStoreConfigData()));
			});
		}
		
		function loadOptions() {
			var $batteryBackgroundColorPicker = $('#battery_bg_color');
			var $batteryForegroundColorPicker = $('#battery_fg_color');
			
			if(localStorage.batteryBackgroundColor) {
				$batteryBackgroundColorPicker[0].value = localStorage.batteryBackgroundColor;
				$batteryForegroundColorPicker[0].value = localStorage.batteryForegroundColor;
			}
		}
		
		function getAndStoreConfigData() {
			var $batteryBackgroundColorPicker = $('#battery_bg_color');
			var $batteryForegroundColorPicker = $('#battery_fg_color');
			
			var options = {
				batteryBackgroundColor: $batteryBackgroundColorPicker.val(),
				batteryForegroundColor: $batteryForegroundColorPicker.val()
			};
			
			localStorage.batteryBackgroundColor = options.batteryBackgroundColor;
			localStorage.batteryForegroundColor = options.batteryForegroundColor;
			
			console.log('Got options: ' + JSON.stringify(options));
			
			return options;
		}
		
		function getQueryParam(variable, defaultValue) {
		  var query = location.search.substring(1);
		  var vars = query.split('&');
		  for (var i = 0; i < vars.length; i++) {
			var pair = vars[i].split('=');
			if (pair[0] === variable) {
			  return decodeURIComponent(pair[1]);
			}
		  }
		  return defaultValue || false;
		}
	</script>
	</body>
</html>